<!--党员死亡弹窗-->
<template>
  <div class="PartyMemberDeath">
    <Modal
      v-model="modal1"
      title="党员出党"
      width="950"
      :styles="{top: '20px'}"
      :mask-closable=false
      class-name="max-height"
      :loading="loading"
      @on-ok="handleSubmit('PartyMemberDeathForm')"
      @on-cancel="cancel">
    	<Form ref="PartyMemberDeathForm" :model="PartyMemberDeathForm"  :label-width="150" :rules="ruleValidate">
        <Row>
            <Col span="12">
                <FormItem label="死亡日期：" prop="date">
                    <DatePicker type="date"  v-model="PartyMemberDeathForm.date" placeholder="选择日期" style=""></DatePicker>
                </FormItem>
                <FormItem label="死亡类型：" style="width: 100%;" prop="decrease_type">
                    <Select v-model="PartyMemberDeathForm.decrease_type" placeholder="请选择" style="width: 61%;">
                    <Option v-for="item in decrease_type_list" :value="item.id">{{item.name}}</Option>
                    </Select>
                </FormItem>
            </Col>
        </Row>
      </Form>
    </Modal>
  </div>
</template>
<script TYPE="text/ecmascript-6">
  export default {
    name:'PartyMemberDeath',
    data () {
      return {
        modal1: true,//是否显示弹窗
        loading: true,
        decrease_type_list:'',
        PartyMemberDeathForm : {
    			decrease_type:"",
       		date :'',
        },
        ruleValidate:{
        	date: [
            {required: true, message: '死亡日期不能为空',trigger: 'change',type:'date'}
          ],
          decrease_type: [
            {required: true, message: '死亡类型不能为空', trigger: 'change'}
          ],
        },
      }
    },
		mounted (){
			this.getTypeList()
		},
    methods: {
      handleSubmit(name) {
        this.$refs[name].validate((valid) => {
          if (valid) {
            this.modal1=false;
						let that = this;
				    let qs = require('qs');
				    let _data = that.PartyMemberDeathForm;
				    _data.dept_id = "";
				    _data.type = 4;
						this.axios({
						    method: 'POST',
								url: '/v1/member/decrease?uid=xxx',
						    data: qs.stringify(_data),
						})
						.then(res => {
						    let needData = res.data;
						    if (needData.code == 200) {
    						this.$Message.success('提交成功!');
										this.$router.push('/dangyuan');
						    } else {
						        that.$Message.error(needData.msg);
						    }
						})
						.catch(err => {
						    this.$Message.error('网络请求异常');
						})
          } else {
	            this.loading=false;
	            this.$Message.error('表单验证失败!');
	            setTimeout(() => {
	              this.loading=true;
	            }, 20);
          }
        })
      },
      cancel () {
 				this.$router.push('/dangyuan');
      },
      getTypeList(){
      	var that = this;
      	let qs = require('qs');
				this.axios({
			    method: 'POST',
					url: '/v1/dictionary/get-list-by-code?type=ZB59&code=21',
					})
					.then(res => {
					    let needData = res.data;
					    if (needData.code == 200) {
					    	that.decrease_type_list = needData.data;
					    } else {
					        that.$Message.error(needData.msg);
					    }
					})
					.catch(err => {
					    this.$Message.error('网络请求异常');
					})
      },
    }
  }
</script>
<style scope>
.ivu-modal-body{
	min-height: 350px;
}
</style>
