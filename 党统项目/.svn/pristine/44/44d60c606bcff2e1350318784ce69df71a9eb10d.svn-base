<template>
    <div class="box-flex start-box box-orient">
        <div class="info-detail box-flex">
            <Row :gutter="16" style="border-bottom: 1px solid #ddd;">
              <Form ref="unitManageForm" :model="unitManageForm" :rules="ruleValidate" label-position="right" :label-width="100">
                <Col span="12">
                    <FormItem label="类型:" prop="prop_type">
                        <Select v-model="unitManageForm.prop_type" :disabled="isDisable" placeholder="请选择选举方式">
                          <Option value="0">法人单位</Option>
                          <Option value="1">内设机构</Option>
                          <Option value="2">机构分组</Option>
                        </Select>
                    </FormItem>
                    <FormItem label="单位(部门)名称:" prop="full_name">
                      <Input v-model="unitManageForm.full_name" :disabled="isDisable" placeholder="请输入单位名称"></Input>
                    </FormItem>
                    <FormItem label="单位隶属关系:" prop="type_id">
                      <Input v-model="unitManageForm.full_name" :disabled="isDisable" placeholder="请输入单位隶属关系"></Input>
                    </FormItem>
                    <FormItem label="单位性质类别:" prop="type_id">
                      <Input v-model="unitManageForm.full_name" :disabled="isDisable" placeholder="请输入单位性质类别"></Input>
                    </FormItem>
                    <FormItem label="所属行业:" prop="belong_type">
                      <Input v-model="unitManageForm.belong_type" :disabled="isDisable" placeholder="请输入所属行业"></Input>
                    </FormItem>
                    <FormItem label="经济类型:" prop="economic_type	">
                      <Input v-model="unitManageForm.economic_type	" :disabled="isDisable" placeholder="请输入经济类型"></Input>
                    </FormItem>
                    <FormItem label="企业类型:" prop="prop_type	">
                      <Input v-model="unitManageForm.prop_type	" :disabled="isDisable" placeholder="请输入企业类型"></Input>
                    </FormItem>
                    <FormItem label="企事业单位类型:" prop="prop_type	">
                      <Input v-model="unitManageForm.prop_type	" :disabled="isDisable" placeholder="请输入企业类型"></Input>
                    </FormItem>
                    <FormItem label="企业规模:" prop="prop_scale">
                      <Input v-model="unitManageForm.prop_scale" :disabled="isDisable" placeholder="请输入企业规模"></Input>
                    </FormItem>
                    <FormItem label="在岗职工数:" prop="number">
                      <Input v-model="unitManageForm.number	" :disabled="isDisable" placeholder="请输入在岗职工数"></Input>
                    </FormItem>
                    <FormItem label="35岁以下在岗职工数:" prop="number_35">
                      <Input v-model="unitManageForm.number_35	" :disabled="isDisable" placeholder="请输入35岁以下在岗职工数"></Input>
                    </FormItem>
                    <FormItem label="在岗职工工人数:" prop="number_workwes">
                      <Input v-model="unitManageForm.number_workwes	" :disabled="isDisable" placeholder="请输入在岗职工工人数"></Input>
                    </FormItem>
                    <FormItem label="在岗职工技术人员数:" prop="number_artisan">
                      <Input v-model="unitManageForm.number_artisan	" :disabled="isDisable" placeholder="请输入在岗职工技术数"></Input>
                    </FormItem>
                </Col>
                <Col span="12">
                  <p style="color: #f34747;margin-bottom: 20px;font-size: 14px;">* 以下为法人单位填写</p>
                  <FormItem label="单位统一社会信用代码:" prop="number_artisan">
                    <Input v-model="unitManageForm.number_artisan	" :disabled="isDisable" placeholder="请输入在岗职工技术数"></Input>
                  </FormItem>
                  <FormItem label="单位建立党的基层组织情况:" prop="number_artisan">
                    <Input v-model="unitManageForm.number_artisan	" :disabled="isDisable" placeholder="请输入在岗职工技术数"></Input>
                  </FormItem>
                  <FormItem label="政府部门建立党组织情况:" prop="number_artisan">
                    <Select v-model="unitManageForm.number_artisan" :disabled="isDisable" placeholder="请选择选举方式">
                      <Option value="0">是</Option>
                      <Option value="1">否</Option>
                    </Select>
                  </FormItem>
                  <FormItem label="街道、乡镇、社区、村标识:" prop="number_artisan">
                    <Select v-model="unitManageForm.number_artisan" :disabled="isDisable" placeholder="请选择">
                      <Option value="0">标识1</Option>
                      <Option value="1">标识2</Option>
                    </Select>
                  </FormItem>
                  <FormItem label="建立党员服务机构标识:" prop="number_artisan">
                    <Select v-model="unitManageForm.number_artisan" :disabled="isDisable" placeholder="请选择选举方式">
                      <Option value="0">是</Option>
                      <Option value="1">否</Option>
                    </Select>
                  </FormItem>
                  <FormItem label="建立党员志愿者队伍:" prop="number_artisan">
                    <Input v-model="unitManageForm.number_artisan	" :disabled="isDisable" placeholder="请输入在岗职工技术数"></Input>
                  </FormItem>
                  <FormItem label="农村专业合作组织标识:" prop="number_artisan">
                    <Input v-model="unitManageForm.number_artisan	" :disabled="isDisable" placeholder="请输入在岗职工技术数"></Input>
                  </FormItem>
                  <p style="font-weight: bold;margin-bottom: 10px;">“两新”组织情况</p>
                  <FormItem label="党建指导员姓名:" prop="real_name">
                    <Input v-model="unitManageForm.real_name	" readonly :disabled="isDisable" placeholder=""></Input>
                  </FormItem>
                  <div class="add-member" @click="addTeacher" style="margin-top: -16px;;padding-left: 108px;color: #d73826;cursor: pointer;font-size: 14px"><Icon type="android-add"></Icon><span style="margin-left: 6px;">添加</span></div>
                  <p style="font-weight: bold;margin-bottom: 10px;">非公有制经济组织</p>
                  <FormItem label="法人代表是否是党员:" prop="number_artisan">
                    <Select v-model="unitManageForm.number_artisan" :disabled="isDisable" placeholder="请选择选举方式">
                      <Option value="0">是</Option>
                      <Option value="1">否</Option>
                    </Select>
                  </FormItem>
                  <FormItem label="法人代表兼任企业党组织书记:" prop="number_artisan">
                    <Select v-model="unitManageForm.number_artisan" :disabled="isDisable" placeholder="请选择选举方式">
                      <Option value="0">是</Option>
                      <Option value="1">否</Option>
                    </Select>
                  </FormItem>
                  <p style="font-weight: bold;margin-bottom: 10px;">社会组织</p>
                  <FormItem label="民办非企业单位类型:" prop="number_artisan">
                    <Select v-model="unitManageForm.number_artisan" :disabled="isDisable" placeholder="请选择选举方式">
                      <Option value="0">律师事务所</Option>
                      <Option value="1">否</Option>
                    </Select>
                  </FormItem>
                  <FormItem label="中介组织类型:" prop="number_artisan">
                    <Select v-model="unitManageForm.number_artisan" :disabled="isDisable" placeholder="请选择选举方式">
                      <Option value="0">律师事务所</Option>
                      <Option value="1">否</Option>
                    </Select>
                  </FormItem>
                </Col>
              </Form>
            </Row>
            <!--<Row :gutter="16" style="margin-top: 20px;">-->
              <!---->
            <!--</Row>-->
        </div>
        <div class="info-footer start-box box-align">
            <div class="box-flex"></div>
            <Button type="ghost" style="margin-right: 15px;"  @click="handleReset('formValidate')">取消</Button>
            <Button v-show="isDisable" type="primary" @click="editBtn">编辑</Button>
            <Button v-show="!isDisable" type="error" @click="handleSubmit('formValidate')">保存</Button>
        </div>
        <UnitTeacher v-if="isShow" @setCancer="setCancer" @setOk="setOk"></UnitTeacher>
    </div>
</template>
<script type="text/ecmascript-6">
    import UnitTeacher from '@/components/pop/unit/UnitTeacher.vue'
    export default {
        name: 'unitForm',
        data() {
            return {
                isShow:false,
                isDisable:false,
                unitManageForm: {
                  prop_type: '',
                  real_name:'',//指导员姓名
                },
                ruleValidate: {
                  prop_type: [{
                        required: true, message: '党组织代码不能为空', trigger: 'blur'
                    }],
                },
                datas: this.infodata,
                dangType: [],
                realtive: [],
                voteStyle: []
            }
        },
        props: ['infodata'],
        components: {
          UnitTeacher
        },
        watch: {
            '$route' (to, from) {
                this.getInfo(this.$route.params['id'],1);
                this.getType();
                this.getRealtive();
                this.getVote();
            },
        },
        methods: {
            //添加指导员
            addTeacher(){
              this.isShow=true;
            },
            setCancer(item) {
              this.isShow=false;
            },
          setOk(item) {
            this.isShow=false;
            let real_name = [];//存储指导员姓名
            item.selection.forEach(item=>{
              real_name.push(item.real_name);
            })
            this.unitManageForm.real_name=real_name.join()
          },
            //党组织类型
            getType() {
                let that = this;
                let qs = require('qs');
                this.axios({
                    method: 'get',
                    url: '/v1/dictionary/get-list-by-type',
                    params: {
                        type: 'D01021',
                    }
                })
                .then(res => {
                    let needData = res.data;
                    if (needData.code == 200) {
                        needData.data.forEach(item => that.dangType.push(item))
                    } else {
                        that.$Message.error(needData.msg);
                    }
                })
                .catch(err => {
                    this.$Message.error('网络请求异常');
                })
            },
            //组织属地关系
            getRealtive() {
                let that = this;
                let qs = require('qs');
                this.axios({
                    method: 'get',
                    url: '/v1/dictionary/get-list-by-type',
                    params: {
                        type: 'D01022',
                    }
                })
                .then(res => {
                    let needData = res.data;
                    if (needData.code == 200) {
                        needData.data.forEach(item => that.realtive.push(item))
                    } else {
                        that.$Message.error(needData.msg);
                    }
                })
                .catch(err => {
                    this.$Message.error('网络请求异常');
                })
            },
            //选举方式
            getVote() {
                let that = this;
                let qs = require('qs');
                this.axios({
                    method: 'get',
                    url: '/v1/dictionary/get-list-by-type',
                    params: {
                        type: 'KZ13',
                    }
                })
                .then(res => {
                    let needData = res.data;
                    if (needData.code == 200) {
                        needData.data.forEach(item => that.voteStyle.push(item))
                    } else {
                        that.$Message.error(needData.msg);
                    }
                })
                .catch(err => {
                    this.$Message.error('网络请求异常');
                })
            },
            editBtn() {
              // console.log(this.$root.$children[0])
              // this.$store.commit('setStrict')
//              this.isDisable=!this.isDisable;
//              this.$store.commit('setEdit', {isDisable: this.isDisable});
            },
            handleSubmit (name) {
                let that = this;
                this.$refs[name].validate((valid) => {
                    if (valid) {
                        this.isDisable =! this.isDisable;//改变编辑状态
                    } else {
                        this.$Message.error('表单验证失败!');
                    }
                })
            },
            handleReset (name) {
//                this.$refs[name].resetFields();
                this.$router.go(-1)
            },
            getInfo(id, type) {
                let that = this;
                let qs = require('qs');
                this.axios({
                    method: 'get',
                    url: '/v1/dept/detail',
                    params: {
                        dept_id: id ? id : 0,
                        opt: type ? type : 0,
                    }
                })
                .then(res => {
                    let needData = res.data;
                    if (needData.code == 200) {
                        that.datas = needData.data;
                        that.formValidate.partycode = that.datas.partycode;
                        that.formValidate.name = that.datas.name;
                        that.formValidate.type_id = that.datas.type_id;
                        that.formValidate.affiliation_id = that.datas.affiliation_id;
                        that.formValidate.found_time = that.datas.found_time;
                        that.formValidate.is_flow = that.datas.is_flow;
                        that.formValidate.start_time = that.datas.start_time;
                        that.formValidate.gap = that.datas.gap;
                        that.formValidate.end_time = that.datas.end_time;
                        that.formValidate.vote_way = that.datas.vote_way;
                        that.formValidate.vote_due = that.datas.vote_due;
                        that.formValidate.vote_actual = that.datas.vote_actual;
                        that.formValidate.leadernum = that.datas.leadernum;
                        that.formValidate.haved_leaders = that.datas.haved_leaders;
                    } else {
                        that.$Message.error(needData.msg);
                    }
                })
                .catch(err => {
                    this.$Message.error('网络请求异常');
                })
            },
        },
        created() {

        },
        mounted() {
            let that = this;
            this.$store.commit('setEdit', {isDisable: this.isDisable});
            this.getInfo(this.$route.params['id'], 1);
            this.getType();
            this.getRealtive();
            this.getVote();

        },
    }
</script>
<style scope>

</style>
