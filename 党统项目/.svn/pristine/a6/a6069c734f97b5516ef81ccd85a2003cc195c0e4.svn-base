<template>
<div class="toolbar">
    <Button type="ghost" @click='toolOpt("Modal-to-add")'>申请人增加</Button>
    <Dropdown @on-click="toolOpt" trigger="click" placement="bottom-start">
        <Button type="ghost">批量处理 <Icon type="arrow-down-b"></Icon></Button>
        <DropdownMenu slot="list">
            <DropdownItem name="Modal-group-batchedit">批量修改</DropdownItem>
            <DropdownItem name="Modal-group-batchadd">批量增加</DropdownItem>
        </DropdownMenu>
    </Dropdown>
    <Button type="ghost" @click="toolOpt('Modal-to-history')">转为历史党员</Button>
    <!--<Dropdown @on-click="toolOpt" trigger="click" placement="bottom-start">-->
        <!--<Button type="ghost">查询／统计 <Icon type="arrow-down-b"></Icon></Button>-->
        <!--<DropdownMenu slot="list">-->
            <!--<DropdownItem name="Modal-search-combos">组合查询</DropdownItem>-->
            <!--&lt;!&ndash; <DropdownItem name="Modal-search-random">随机统计</DropdownItem>-->
            <!--<DropdownItem name="Modal-search-single">一个党组织的组合统计</DropdownItem>-->
            <!--<DropdownItem name="Modal-search-multi">多个党组织的组合统计</DropdownItem> &ndash;&gt;-->
        <!--</DropdownMenu>-->
    <!--</Dropdown>-->
    <Button type="ghost">信息校核</Button>
</div>
</template>

<script>
export default {
    name: 'opt-nav',
    props:{
        currentRow:null,
        uid: null,
        remberRow:null,
    },
    data() {
        return {
            modal: this.modalname,
            Row: this.currentRow,
        }
    },
    watch: {
        currentRow(newVal, oldVal) {
            this.Row = newVal
        },
        uid(newVal, oldVal){
            this.uid = newVal;

        },
        remberRow(newVal, oldVal){
            this.remberRow = newVal;
        }
    },
    methods: {
        toolOpt(name) {
            let that = this;
            let menuName = name.split('-');
            if (menuName.length < 3) {
                return
            }
            this.$emit('select');
            if(menuName[2]=="history"){
                if(!that.$route.params.dept||!that.remberRow){
                    this.$Message.error('请选择申请人');
                    return
                }
                this.$Modal.confirm({
                    title: '警告',
                    content: '确定要将'+that.remberRow.row['real_name']+'转为历史党员吗？',
                    onOk: () => {
                        var that = this;
                        let qs = require('qs')
                        that.axios({
                            url:'/v1/member/applytohistory',
                            method:'get',
                            params:{
                                uid : that.uid,
                                dept_id : that.$route.params.dept,
                            },
                        })
                        .then(res=>{
                            let needData = res.data;
                            if (needData.code == 200) {
                                this.$Message.success('操作成功');
                                that.$emit('del');
                            } else {
                                that.Message.error(needData.msg);
                            }
                        })
                        .catch(err=>{
                            this.Message.error('网络请求异常');
                        })

                    },
                    onCancel: () => {
                    // this.$Message.info('操作取消');
                    }
                });
            }else {
                if(!this.$route.params.dept){
                    this.$Message.error('请选择党支部或者党小组');
                    return
                }
                this.$router.push({
                    path: '/applicantManage/modal/' + menuName[2],
                    query: {
                        dept_id: this.$route.params.dept,
                    }
                });
            }

        }
    },
    created() {

    },
    mounted() {

    }
}
</script>

<style scope>
.toolbar .ivu-btn-ghost {
    background-color: #fff;
}
</style>
